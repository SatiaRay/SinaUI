name: ðŸ§ª Deploy Development

on:
  push:
    branches:
      - "release/*"
  workflow_dispatch:

jobs:
  deploy:
    name: ðŸ›  Deploy Development Server
    runs-on: dev-runner

    steps:
      - name: ðŸ“¥ Pull or Clone Repository
        run: |
          PROJECT_DIR="/srv/projects/ai-react"
          BRANCH="${{ github.ref_name }}"

          if [ -d "$PROJECT_DIR/.git" ]; then
            echo "ðŸ”„ Project already cloned. Pulling latest changes..."
            cd "$PROJECT_DIR"
            git fetch origin "$BRANCH"
            git checkout "$BRANCH"
            git pull origin "$BRANCH"
          else
            echo "ðŸ“¦ Cloning fresh project..."
            git clone -b "$BRANCH" git@github.com:satiarepomahmoudi/ai-react.git "$PROJECT_DIR"
            cd "$PROJECT_DIR"
            npm install
          fi

      - name: ðŸš§ Build Docker Image for Development
        run: |
          cd /srv/projects/ai-react
          docker build --build-arg REACT_APP_ENV_FILE=.env.development -t react-app-test .

      - name: ðŸš€ Deploy with Docker
        run: |
          cd /srv/projects/ai-react
          docker run -d -p 80:80 react-app-test

      - name: âœ… Done
        run: echo "âœ” Development deployed with Docker!"
